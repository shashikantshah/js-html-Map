<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"rel="stylesheet" crossorigin="anonymous"/>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" defer></script>

    <style>
      .form-select:focus,
      .form-select:active {
        outline: none !important;
        box-shadow: none;
        border-color: black !important;
      }

      .form-select,
      .form-select {
        border-color: black !important;
        border-top: none !important;
        border-left: none;
        border-right: none;
        border-radius: 0px !important;
      }

      img.huechange {
        filter: hue-rotate(120deg);
      }
      a {
          color: black;
          text-decoration: none;
      }

      .Home_TextFocus_Body {
        font-size: 16px;
        text-align: justify;
      }

      .Right-WidthDivisionImage {
        display: inline-block;
        vertical-align: top;
        width: 130px;
        margin-top: 15px;
      }

      .Right-WidthDivisionText {
        display: inline-block;
        vertical-align: top;
        width: 55%;
        margin-left: 5px;
      }
    </style>
    <script>
      window.onload = function () {
        
       let countryselect = document.getElementById("country-select");
       let citySelect = document.getElementById("city-select");
       var marker;
       let dataCountry ;
       let optionTagList ;
       let CitySelectTag 
       let arrayCountryList = [];
       let EmpDiv;

       citySelect.style.display = "none"
       var map = L.map("map").setView([41.8719, 12.5674], 6);
       L.tileLayer(
          "https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",
          {
            attribution: " ",
          }
        ).addTo(map);

        /* // Note-> url serch by CountyId column // this code prepare the result of Employee List based on country  
        let EmpListByCounty = async (id) =>{
             let responseEmp = await fetch(""+id);
             let datasEmp = await responseEmp.json();
             datasEmp.forEach((value)=>{
                    EmpDiv =   "<div class='Home_TextFocus_Body py-0 px-1'> <div class='Right-WidthDivisionImage'>  <img class='card-img-top' style='max-width:130px;' alt='Card image cap' src='"+ value.imageUrl+"'></div> <div class='Right-WidthDivisionText pt-3'><h4 class='mb-0' style='font-family: PG_Fonts_LatoLightItalic;'>"+ value.name +"</h4><label class='PG_InnerPage_HeaderSubTitle text-center small pb-2'>" + value.Department + "</label><p class='card-text'><span><a title='' style='display: block;' href='mailto:"+ value.Email +"'>"+ value.Email +"</a> </span> <span class='Telefono'>"+ value.Phone +"</span></p></div>  </div><hr style='border-top: dotted 1px;'>"
             });
        }
         */

         /* // Note-> url serch by CityId column   // this code prepare the result of Employee List based on City  
        let EmpListByCity = async (id) =>{
             let responseEmp = await fetch(""+id);
             let datasEmp = await responseEmp.json();
             datasEmp.forEach((value)=>{
                    EmpDiv =   "<div class='Home_TextFocus_Body py-0 px-1'> <div class='Right-WidthDivisionImage'>  <img class='card-img-top' style='max-width:130px;' alt='Card image cap' src='"+ value.imageUrl+"'></div> <div class='Right-WidthDivisionText pt-3'><h4 class='mb-0' style='font-family: PG_Fonts_LatoLightItalic;'>"+ value.name +"</h4><label class='PG_InnerPage_HeaderSubTitle text-center small pb-2'>" + value.Department + "</label><p class='card-text'><span><a title='' style='display: block;' href='mailto:"+ value.Email +"'>"+ value.Email +"</a> </span> <span class='Telefono'>"+ value.Phone +"</span></p></div>  </div><hr style='border-top: dotted 1px;'>"
             });
        }
         */

        let getCountriesOnLoad = async () => {
          let response = await fetch("https://laravel-world.com/api/countries");
          let datas = await response.json();
           dataCountry = await datas;
           dataCountry.data.forEach(value =>  {
            arrayCountryList.push(value.name); // remove this line when url loaded by our project 
        /*     //this code call the store County id in array. And embedded the marker. And hightlight default marker, if it is set in database.
           arrayCountryList.push(value.Id);
            marker = L.marker([value.lat, value.lng]).addTo(map);
             if(value.defaultMarker){
              marker._icon.classList.add("huechange");
             } */
           });
           /*  // this code call the EmpListByCounty function. and embed Employee list data in body 
          var id = value.id;
          await EmpListByCounty(id);
          document.getElementsByClassName("EmpData").outerHTML = "<div class='EmpData'>" + EmpDiv;  + "</div>";*/
          return datas; 
        }

        /*   //this code fetch data by CountyID(foreignkey) and get the data in json.  prepare the result of City Option Tag List. And embedded the marker. And hightlight default marker, if it is set in database.
        const getCityOnLoad = async (Id)=>{
          let response = await fetch(""+Id);
              let data = await response.json;
             await data.forEach((value)=>{
                if(value.defaultMarker){
                  optionTagList += "<option value=" + value.id + "," + value.lat + "," + value.lng + "selected>" + value.cityname + "</option>"
                  marker._icon.classList.add("huechange");
                }
                else{
                     marker = L.marker([value.lat, value.lng]).addTo(map);
                  optionTagList += "<option value=" + value.id + "," + value.lat + "," + value.lng + ">" + value.cityname + "</option>"
                }
              });
                // this code call the EmpListByCity function. and embed Employee list data in body 
          await EmpListByCity(Id);
          document.getElementsByClassName("EmpData").outerHTML = "<div class='EmpData'>" + EmpDiv;  + "</div>";
        }
        */

          /* //  //this code fetch data by CountyID(foreignkey) and get the data in json.  prepare the result of City Option Tag List.
        let getCityOnClick = async (Id)=>{
          let response = await fetch(""+Id);
              let data = await response.json;
             await data.forEach((value)=>{
                 optionTagList += "<option value=" + value.id + "," + value.lat + "," + value.lng + "selected>" + value.cityname + "</option>"
              });
        }
        */

        let mainFunc = async () => {
           await getCountriesOnLoad();
         /* //this code call the getCityOnLoad function. and embed SELECT-TAG  data in div of body.
           await getCityOnLoad(Id); //uncomment this line when url loaded by our project
        CitySelectTag = "<div class='CityInnerhtml'><select class='form-select' id='city-select'> <option selected>Select City</option>" + optionTagList + "</select></div>";
        document.getElementsByClassName("CityInnerhtml").outerHtml = CitySelectTag; */
        } 

        mainFunc();

        // start to remove below code line when url loaded by our project 
            marker = L.marker([41.8719, 12.5674]).addTo(map);
            marker = L.marker([44.14854173101319, 11.004108406250005]).addTo(map);
            marker = L.marker([40.43788431923593, 15.816120125000005]).addTo(map);
            marker = L.marker([20.5937, 78.9629]).addTo(map);
            marker = L.marker([39.73, -104.8]).addTo(map);
            marker = L.marker([39.77, -105.23]).addTo(map);
        // Stope here to remove code 

       // let ArrayCountry  = ["Italy"];
     
      countryselect.addEventListener("change", function () {
        
          var selectedOption = this.options[this.selectedIndex];
          var ValueCounty = selectedOption.value; // remove this line when url loaded by our project 
          var position = selectedOption.value.split(",");
          // var Id = parseFloat(position[0]); //uncomment this line when url loaded by our project
          let findCountry =  arrayCountryList.includes(ValueCounty); // remove this line when url loaded by our project 
          // let findCountry =  arrayCountryList.includes(Id); //uncomment this line when url loaded by our project
          if (findCountry) {
            citySelect.style.display = "block"; //remove this line in the future
            /* //this code call the getCityOnClick function. and embed SELECT-TAG  data in div of body.
            var OptionSelectTag = async () => { 
              //below code call the getCityOnClick function..
               await getCityOnClick(ValueCounty); // remove this line when url loaded by our project 
               //await getCityOnClick(Id); //uncomment this line when url loaded by our project
            }
            OptionSelectTag();
            CitySelectTag = "<div class='CityInnerhtml'><select class='form-select' id='city-select'> <option selected>Select City</option>" + optionTagList + "</select></div>";
            document.getElementsByClassName("CityInnerhtml").outerHTML = CitySelectTag; */
          } else {
            /*  // this code call the EmpListByCounty function. and embed Employee list data in body
          var id = parseFloat(position[0]);
          await EmpListByCounty(id);
          document.getElementsByClassName("EmpData").outerHTML = "<div class='EmpData'>" + EmpDiv;  + "</div>";  */
            citySelect.style.display  = "none"; // remove this line in the future
            var countryName = selectedOption.text;
            var position = selectedOption.value.split(",");
            var lat = parseFloat(position[1]);
            var lng = parseFloat(position[2]);
            marker.setLatLng([lat, lng]);
            marker._icon.classList.add("huechange");
            marker.bindPopup(
              "<b>" + countryName + "</b>"
            );
            map.setView([lat, lng], 6);
          }
        
        });
     

        citySelect.addEventListener("change", function () {
          /*  // this code call the EmpListByCity function. and embed Employee list data in body 
          var Id = parseFloat(position[0]);
          await EmpListByCity(Id);
          document.getElementsByClassName("EmpData").outerHTML = "<div class='EmpData'>" + EmpDiv;  + "</div>"; */
          var selectedOption = this.options[this.selectedIndex];
          var countryName = selectedOption.text;
          var position = selectedOption.value.split(",");
          var lat = parseFloat(position[1]);
          var lng = parseFloat(position[2]);
          marker.setLatLng([lat, lng]);
          marker._icon.classList.add("huechange");
          marker.bindPopup(
            "<b>" + countryName + "</b>"
          );
          map.setView([lat, lng], 6);
        });
      };

    
    </script>
  </head>

  <body>
    <div class="container text-center">
      <div class="title py-5">
        <h1 class="text-uppercase">select county</h1>
      </div>
      <div class="row py-5">
        <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6 align-self-start">
          <div class="col-lg-10 col-xl-10 align-self-center">
            <div class="pt-4">
              <select class="form-select" id="country-select">
                <option selected>Select Country</option>
                <option value="Italy">Italy</option>
                <option value="India,20.5937,78.9629">India</option>
                <option value="United States,40.7127753,-74.0059728">United States</option>
                <option value="France,48.856614,2.352222">France</option>
              </select>
            </div>
            <div class="py-4">
              <div class="CityInnerhtml">

              </div>
              <select class="form-select" id="city-select">
                <option selected>Select City</option>
                <option value="Cityid,41.8719,12.5674">Rom</option>
                <option value="CityId,44.14854173101319,11.004108406250005">
                  Lizzo
                </option>
                <option value="40.43788431923593,15.816120125000005">
                  Galvalio
                </option>
              </select>
            </div>
            <div class="py-4">
               <div class="EmpData">

               </div>
                <div class="" > 
                    <div class="Home_TextFocus_Body py-0 px-1" >
                      <div class="Right-WidthDivisionImage">
                        <img class="card-img-top" style="max-width:130px;" alt="Card image cap" src="https://www.progold.com/Storage/UsersPhoto/BLUCLAD_BN/138.jpg">
                      </div>
                      <div class="Right-WidthDivisionText pt-3">
                        <h4 class="mb-0" style="font-family: PG_Fonts_LatoLightItalic;">ELLIS ZAMBONI</h4>
                        <label class="PG_InnerPage_HeaderSubTitle text-center small pb-2" >Technical Assistance Coating</label>
                        <p class="card-text">
                          <span>
                            <a title="" style="display: block;" href="mailto:e.zamboni@bluclad.it">e.zamboni@bluclad.it</a>
                          </span>
                          <span class="Telefono">+39 055 4623234</span>
                        </p>
                      </div>
                    </div>
                    <hr style="border-top: dotted 1px;">
                    <div class="Home_TextFocus_Body py-0 px-1" >
                      <div class="Right-WidthDivisionImage">
                        <img class="card-img-top" style="max-width:130px;" alt="Card image cap" src="https://www.progold.com/Storage/UsersPhoto/BLUCLAD_BN/87.jpg">
                      </div>
                      <div class="Right-WidthDivisionText pt-3">
                        <h4 class="mb-0" style="font-family: PG_Fonts_LatoLightItalic; ">MARIO LAVANGA</h4>
                        <label class="PG_InnerPage_HeaderSubTitle text-center small pb-2">Technical Assistance Coating</label>
                        <p class="card-text">
                          <span>
                            <a title="" style="display: block;" href="mailto:m.lavanga@bluclad.it">m.lavanga@bluclad.it</a>
                          </span>
                          <span class="Telefono">+39 055 4623234</span>
                        </p>
                      </div>
                    </div>
                  
                    <hr style="border-top: dotted 1px;">				 
                </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6 align-self-start">
          <div id="map" style="height: 500px; width: 100%"></div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" defer></script>
  </body>
</html>
